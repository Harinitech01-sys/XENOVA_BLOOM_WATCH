<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bloom Prediction System</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
          integrity="sha384-tgp4KFuBkEkJmJkFpEfQFowwg/dklD0x7zzH9p4l8XjDbB3sKz8GGP1cDYQmA8h6" crossorigin=""/>
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 1200px;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 300;
        }
        
        .content-wrapper {
            display: flex;
            min-height: 500px;
        }
        
        .form-section {
            flex: 1;
            padding: 30px;
            background: #f8f9fa;
        }
        
        .map-section {
            flex: 2;
            position: relative;
        }
        
        #map {
            height: 500px;
            width: 100%;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }
        
        .form-control {
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            padding: 15px 20px;
            font-size: 16px;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .form-control:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 0.2rem rgba(76, 175, 80, 0.25);
            outline: none;
        }
        
        .form-control::placeholder {
            color: #999;
            font-style: italic;
        }
        
        .btn-predict {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: 600;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 16px;
        }
        
        .btn-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn-predict:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 3px;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        .alert {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            border: none;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .form-section, .map-section {
                flex: none;
            }
            
            #map {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>üå∏ Bloom Prediction System</h1>
            <p class="mb-0">Analyze and predict bloom patterns with satellite data</p>
        </div>
        
        <div class="content-wrapper">
            <div class="form-section">
                <h3 class="mb-4">üåç Bloom Prediction</h3>
                
                {% if error %}
                <div class="alert alert-danger">
                    <strong>Error:</strong> {{ error }}
                </div>
                {% endif %}
                
                <form id="bloomForm" method="POST" action="/predict">
                    <!-- Region Input -->
                    <div class="form-group">
                        <label for="region_name" class="form-label">üåç Enter Region Name</label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="region_name" 
                            name="region_name" 
                            placeholder="e.g., Mumbai, California, India, London, Tokyo..." 
                            required
                        >
                        <div class="help-text">
                            Enter any country, state, or city name (e.g., India, California, Mumbai, London)
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="date" class="form-label">üìÖ Select Date</label>
                        <input type="date" class="form-control" id="date" name="date" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="bloom_type" class="form-label">üå∏ Bloom Type</label>
                        <select class="form-control" id="bloom_type" name="bloom_type" required>
                            <option value="">Select bloom type...</option>
                            <option value="algal">Algal Bloom</option>
                            <option value="plant">Plant Bloom</option>
                            <option value="mixed">Mixed Bloom</option>
                            <option value="seasonal">Seasonal Flowers</option>
                            <option value="agricultural">Agricultural Crops</option>
                        </select>
                    </div>
                    
                    <button type="submit" class="btn btn-predict" id="predictBtn">
                        üîç Predict Bloom Patterns
                    </button>
                </form>
            </div>
            
            <div class="map-section">
                <div id="map"></div>
                <div class="loading-overlay" id="loadingOverlay">
                    <div class="spinner"></div>
                </div>
                
                <div class="legend">
                    <h6><strong>Bloom Intensity</strong></h6>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #33FF57;"></div>
                        <span>High Bloom</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF8C00;"></div>
                        <span>Moderate Bloom</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF5733;"></div>
                        <span>Low Bloom</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #CCCCCC;"></div>
                        <span>No Data</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
            integrity="sha384-8L3R5Nl5vz5z9a/rjCkHN6K/aCQYWMCw1rJGSEqjK3eFo0kEuAFm3u3qMjKjHdmk" crossorigin=""></script>
    
    <script>
        // Initialize map
        var map = L.map('map').setView([20.0, 78.0], 4);
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
        
        var bloomLayer = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîÑ Page loaded, initializing...');
            setDefaultDate();
            setupEventListeners();
            loadSampleBloomData();
        });

        function setDefaultDate() {
            const today = new Date();
            const dateString = today.toISOString().split('T')[0];
            document.getElementById('date').value = dateString;
            console.log(`üìÖ Default date set: ${dateString}`);
        }

        function setupEventListeners() {
            console.log('üîß Setting up event listeners...');
            
            // Form submission handling
            const form = document.getElementById('bloomForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    console.log('üìù Form submitted');
                    
                    if (!validateForm()) {
                        e.preventDefault();
                        return;
                    }
                    
                    // Show loading overlay
                    document.getElementById('loadingOverlay').style.display = 'flex';
                    document.getElementById('predictBtn').disabled = true;
                });
            }

            console.log('‚úÖ Event listeners setup complete');
        }

        function validateForm() {
            const regionName = document.getElementById('region_name').value.trim();
            const date = document.getElementById('date').value;
            const bloomType = document.getElementById('bloom_type').value;
            
            console.log(`üîç Validating form: region=${regionName}, date=${date}, bloom=${bloomType}`);
            
            const errors = [];
            
            if (!regionName) {
                errors.push('Please enter a region name');
            }
            
            if (regionName.length < 2) {
                errors.push('Region name must be at least 2 characters');
            }
            
            if (!date) {
                errors.push('Please select a date');
            }
            
            if (!bloomType) {
                errors.push('Please select a bloom type');
            }
            
            if (errors.length > 0) {
                alert('Please fix the following errors:\n‚Ä¢ ' + errors.join('\n‚Ä¢ '));
                console.log(`‚ùå Validation errors: ${errors.join(', ')}`);
                return false;
            }
            
            console.log('‚úÖ Form validation passed');
            return true;
        }

        function getBloomColor(intensity) {
            if (intensity >= 0.7) return '#33FF57';
            if (intensity >= 0.4) return '#FF8C00';
            if (intensity >= 0.1) return '#FF5733';
            return '#CCCCCC';
        }
        
        function loadSampleBloomData() {
            console.log('üó∫Ô∏è Loading sample bloom data');
            
            var sampleData = [
                {
                    "type": "Feature",
                    "properties": {
                        "name": "Indian Subcontinent",
                        "bloom_intensity": 0.8
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [68, 8], [97, 8], [97, 37], [68, 37], [68, 8]
                        ]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "North America",
                        "bloom_intensity": 0.6
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [-130, 25], [-65, 25], [-65, 50], [-130, 50], [-130, 25]
                        ]]
                    }
                }
            ];
            
            if (bloomLayer) {
                map.removeLayer(bloomLayer);
            }
            
            bloomLayer = L.geoJSON(sampleData, {
                style: function(feature) {
                    return {
                        fillColor: getBloomColor(feature.properties.bloom_intensity),
                        weight: 2,
                        opacity: 1,
                        color: 'white',
                        dashArray: '3',
                        fillOpacity: 0.6
                    };
                },
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<div style="text-align: center;">' +
                        '<strong>' + feature.properties.name + '</strong><br>' +
                        'Bloom Intensity: ' + (feature.properties.bloom_intensity * 100).toFixed(1) + '%' +
                        '</div>'
                    );
                }
            }).addTo(map);
            
            console.log('‚úÖ Sample bloom data loaded');
        }
    </script>
</body>
</html>
